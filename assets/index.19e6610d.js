var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,l=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&o(e,a,t[a]);if(n)for(var a of n(t))i.call(t,a)&&o(e,a,t[a]);return e},c=(e,n)=>t(e,a(n));import{d as r,bj as d,b4 as p,l as u,m,o as f,k as y,A as h,c as b,e as g,B as v,f as w,r as k,M as I,aC as C,bh as R,w as S,i as K}from"./vendor.f076b15a.js";import{_ as j}from"./form-modal.6ec28ff9.js";import{a as x,d as O,p as A,g as D,b as T}from"./index.4823cf15.js";import{f as L}from"./common.bf91f2f4.js";import{u as N}from"./index.d2a8cc1f.js";import"./schema-form.953f1512.js";import"./index.11148bba.js";var P=r({name:"AccessTree",components:{[d.name]:d,[p.name]:p},props:{value:{type:Array,default:()=>[]}},emits:["update:value"],setup(e,{emit:t}){const a=u({treeData:[],spinning:!1,replaceFields:{key:"id"}}),n=(e,t=-1)=>e.filter((e=>e.moduleId==t)).map((t=>c(l({},t),{title:t.moduleName||t.actionName,children:n(e,t.id)}))),s=m({get:()=>e.value,set:e=>t("update:value",Array.isArray(e)?e:e.checked)});f((async()=>{a.spinning=!0;const e=await x().finally((()=>a.spinning=!1));a.treeData=n(e)}));const i=(e,t=[])=>e.eventKey?(t.push(e.eventKey),i(e.vcTreeNode,t)):t,o=(e,t=[])=>(null==e?void 0:e.children.length)>0?e.children.reduce(((e,t)=>(t.children.length>0&&e.push(...o(t,e),[]),e.concat([t.id]))),t):t;return c(l({},y(a)),{checkedKeys:s,onCheck:(e,{node:t,checked:a})=>{var n,l,c;let r=s.value;if(a)r=[...new Set([...s.value,...e.checked,...i(t.vcTreeNode),...o(t.dataRef)])];else{const a=o(t.dataRef);r=a.length>0?e.checked.filter((e=>!a.includes(e))):e.checked;((null==(c=null==(l=null==(n=t.vcTreeNode)?void 0:n.dataRef)?void 0:l.children)?void 0:c.map((e=>e.id)))||[]).some((e=>r.includes(e)))||(r=r.filter((e=>{var a;return e!=(null==(a=t.vcTreeNode)?void 0:a.eventKey)})))}s.value=r}})}});P.render=function(e,t,a,n,s,i){const o=h("a-tree"),l=h("a-spin");return b(),g(l,{spinning:e.spinning},{default:v((()=>[w(o,{checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":t[1]||(t[1]=t=>e.checkedKeys=t),style:{"min-height":"40px"},checkable:"",checkStrictly:"",selectable:!1,"tree-data":e.treeData,"replace-fields":e.replaceFields,onCheck:e.onCheck},null,8,["checkedKeys","tree-data","replace-fields","onCheck"])])),_:1},8,["spinning"])};const _=()=>({style:{width:"auto"},formItemLayout:{labelCol:{span:4},wrapperCol:{span:20}},formItem:[{type:"input",label:"角色名称",field:"title",value:"",props:{placeholder:"请输入角色名称"},rules:[{required:!0,message:"角色名称不能为空"}]},{type:"textarea",label:"描述",field:"description",value:"",props:{placeholder:"角色描述"}},{type:w(P),label:"资源",field:"accessIdsList",value:[],asyncValue:async(e,t)=>{const{id:a}=null==t?void 0:t.props.fields;return(await x(a)).map((e=>e.accessId))}}]}),F=[{title:"角色名称",dataIndex:"title"},{title:"描述",dataIndex:"description"},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>L(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>L(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},t)=>await O(e.id).then((()=>t()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:e},t)=>N({title:"编辑角色",fields:e,formSchema:_(),handleOk:async(a,n)=>{const{description:s,title:i,accessIdsList:o}=a,l={description:s,title:i,accessIdsList:o.toString()};return await A(e.id,l).then((()=>t()))}})}]}];var q=r({name:"SystemRole",components:{DynamicTable:j},setup(){const e=k(null),t=u({tableLoading:!1,rowSelection:{onChange:(e,a)=>{t.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),a=m((()=>0==t.rowSelection.selectedRowKeys.length));return c(l({},y(t)),{columns:F,tableRef:e,isDisabled:a,getAdminRole:D,paginationChange:(e,t,a,{currentDataSource:n})=>{},addItem:()=>{N({title:"添加角色",formSchema:_(),handleOk:async(t,a)=>{const{description:n,title:s,accessIdsList:i}=t,o={description:n,title:s,accessIdsList:i.toString()};await T(o),e.value.refreshTableData()}})},deleteItems:()=>{I.confirm({title:"提示",icon:w(C),content:"您确定要删除所有选中吗？",onOk:async()=>{await O(t.rowSelection.selectedRowKeys.toString()),e.value.refreshTableData(),t.rowSelection.selectedRowKeys=[]}})}})}});const B=K(" 添加 "),E=K(" 删除 ");q.render=function(e,t,a,n,s,i){const o=h("a-button"),l=h("dynamic-table"),c=R("permission");return b(),g(l,{ref:"tableRef",columns:e.columns,"get-list-func":e.getAdminRole,rowKey:"id","row-selection":e.rowSelection,onChange:e.paginationChange},{title:v((()=>[S(w(o,{type:"primary",onClick:e.addItem},{default:v((()=>[B])),_:1},8,["onClick"]),[[c,{action:"create",effect:"disabled"}]]),S(w(o,{disabled:e.isDisabled,type:"primary",onClick:e.deleteItems},{default:v((()=>[E])),_:1},8,["disabled","onClick"]),[[c,{action:"delete"}]])])),_:1},8,["columns","get-list-func","row-selection","onChange"])};export default q;
