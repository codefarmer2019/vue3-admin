var e=Object.assign;import{c as a,n as l,bK as t,cd as o,s,cx as d,cy as n,d as r,aa as i,ct as c,cp as u,cr as m,r as p,S as f,aw as b,t as v,aQ as y,x as R,y as g,Z as w,z as h,A as x,F as I,a3 as k,$ as A,a0 as _,a2 as N,a1 as E,X as C,U as S,bs as T,a5 as j,C as O}from"./index.c2de4877.js";import{_ as L}from"./dynamic-table.cd5d68ec.js";import{I as q}from"./schema-form.05eb43a4.js";import{f as U}from"./common.dd914d5e.js";import{I as F}from"./icon-font.4372b6b1.js";import{Q as K}from"./QuestionCircleOutlined.7b1eb37b.js";import"./vendor.183d7d35.js";const M=(o,s,d)=>{let n=null;const r=document.createElement("div"),i=()=>{t(null,r),n=null,r.remove()};return n=a(o),n.props=l(n.props,e({remove:i},s)),t(n,r),n.component.ctx.remove=i,n.component.ctx.$updateProps=function(e){e&&Object.keys(e).forEach((a=>{n.component.props[a]=e[a]}))},n.component.ctx};var D,P;function Q(e){return d.request({url:D.adminAccess,method:n.GET,params:e})}function $(e){return d.request({url:[D.adminAccess,e].join("/"),method:n.DELETE},{isShowErrorMessage:!0,successMessageText:"删除成功"})}(P=D||(D={})).adminAccess="/admin/access",P.adminAccessModule="/admin/access/module";var G=r({name:"add-modal",components:{[i.name]:i,[c.name]:c,[c.Item.name]:c.Item,[q.name]:q,[u.name]:u,[m.name]:m,ASelectOption:m.Option},props:{remove:{type:Function},fields:{type:Object,default:()=>({})},callback:{type:Function}},setup(a){const l=p(null),t=f({visible:!0,confirmLoading:!1,moduleList:[]}),o=f({moduleName:"",moduleId:void 0,actionName:"",type:void 0,url:"",icon:"",sort:1,keepAlive:1});a.fields.moduleId&&(Object.keys(o).forEach((e=>o[e]=a.fields[e])),o.type=-1==a.fields.moduleId?1:2);b((async()=>{var e;t.moduleList=await d.request({url:D.adminAccessModule,method:n.GET,params:e})}));return e(e({},v(t)),{formRef:l,rules:{moduleName:[{required:!0,message:"模块名称不能为空"}],moduleId:[{required:!0,message:"模块名称不能为空"}],actionName:[{required:!0,message:"请输入菜单名称"}],type:[{required:!0,message:"请选择类型"}],url:[{required:!0,message:"请输入url地址"}]},prefix:"/vite-vue3-admin/",labelCol:{span:6},wrapperCol:{span:18},modelRef:o,handleOk:e=>{e.preventDefault(),t.confirmLoading=!0,l.value.validate().then((async()=>{const e=a.fields.id,l=y(o);e&&delete l.type,await(e?function(e,a){return d.request({url:[D.adminAccess,e].join("/"),method:n.PATCH,params:a},{isShowErrorMessage:!0,successMessageText:"修改成功"})}(e,l):function(e){return d.request({url:D.adminAccess,method:n.POST,params:e},{isShowErrorMessage:!0,successMessageText:"创建成功"})}(l)).finally((()=>t.confirmLoading=!1)),t.visible=!1,a.callback&&a.callback()})).catch((e=>{t.confirmLoading=!1}))}})}});const z=I("data-v-4be6cd36");R("data-v-4be6cd36");const H=N(" 模块 "),X=N(" 菜单 "),Z=N(" 否 "),B=N(" 是 ");g();const J=z(((e,l,t,o,s,d)=>{const n=w("a-select-option"),r=w("a-select"),i=w("a-form-item"),c=w("a-input"),u=w("a-input-number"),m=w("a-form"),p=w("a-modal");return h(),x(p,{title:Number.isInteger(e.fields.id)?"编辑资源":"新增资源",visible:e.visible,"onUpdate:visible":l[9]||(l[9]=a=>e.visible=a),"confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.handleOk},{default:z((()=>[a(m,{ref:"formRef",model:e.modelRef,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:z((()=>[a(i,{label:"类别",rules:e.rules.type,name:"type"},{default:z((()=>[a(r,{value:e.modelRef.type,"onUpdate:value":l[1]||(l[1]=a=>e.modelRef.type=a),disabled:Number.isInteger(e.fields.id),placeholder:"请选择类型"},{default:z((()=>[a(n,{value:1},{default:z((()=>[H])),_:1}),a(n,{value:2},{default:z((()=>[X])),_:1})])),_:1},8,["value","disabled"])])),_:1},8,["rules"]),1==e.modelRef.type?(h(),x(i,{key:0,label:"模块名称",rules:e.rules.moduleName,name:"moduleName"},{default:z((()=>[a(c,{value:e.modelRef.moduleName,"onUpdate:value":l[2]||(l[2]=a=>e.modelRef.moduleName=a),disabled:Number.isInteger(e.fields.id),placeholder:"请输入模块名称"},null,8,["value","disabled"])])),_:1},8,["rules"])):k("",!0),2==e.modelRef.type?(h(),x(i,{key:1,label:"模块名称",rules:e.rules.moduleId,name:"moduleId"},{default:z((()=>[a(r,{value:e.modelRef.moduleId,"onUpdate:value":l[3]||(l[3]=a=>e.modelRef.moduleId=a),disabled:Number.isInteger(e.fields.id),placeholder:"请选择模块"},{default:z((()=>[(h(!0),x(A,null,_(e.moduleList,(e=>(h(),x(n,{key:e.id,value:e.id},{default:z((()=>[N(E(e.moduleName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1},8,["rules"])):k("",!0),2==e.modelRef.type?(h(),x(i,{key:2,label:"菜单名称",rules:e.rules.actionName,name:"actionName"},{default:z((()=>[a(c,{value:e.modelRef.actionName,"onUpdate:value":l[4]||(l[4]=a=>e.modelRef.actionName=a),placeholder:"请输入菜单名称"},null,8,["value"])])),_:1},8,["rules"])):k("",!0),a(i,{label:"路径",rules:e.rules.url,name:"url"},{default:z((()=>[a(c,{value:e.modelRef.url,"onUpdate:value":l[5]||(l[5]=a=>e.modelRef.url=a),placeholder:"请输入路径"},null,8,["value"])])),_:1},8,["rules"]),a(i,{label:"小图标"},{default:z((()=>[a(c,{value:e.modelRef.icon,"onUpdate:value":l[6]||(l[6]=a=>e.modelRef.icon=a),placeholder:"小图标"},null,8,["value"]),a("a",{href:`${e.prefix}#/icons`,target:"_blank"},"可选图标",8,["href"])])),_:1}),a(i,{label:"排序"},{default:z((()=>[a(u,{value:e.modelRef.sort,"onUpdate:value":l[7]||(l[7]=a=>e.modelRef.sort=a),min:1,placeholder:"排序"},null,8,["value"])])),_:1}),a(i,{label:"keepAlive",name:"keepAlive"},{default:z((()=>[a(r,{value:e.modelRef.keepAlive,"onUpdate:value":l[8]||(l[8]=a=>e.modelRef.keepAlive=a),placeholder:"是否缓存页面"},{default:z((()=>[a(n,{value:0},{default:z((()=>[Z])),_:1}),a(n,{value:1},{default:z((()=>[B])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model","label-col","wrapper-col"])])),_:1},8,["title","visible","confirm-loading","afterClose","onOk"])}));G.render=J,G.__scopeId="data-v-4be6cd36";const V=[{title:"名称",dataIndex:"moduleName",slots:{customRender:"moduleName"}},{title:"url地址",dataIndex:"url"},{title:"icon图标",dataIndex:"icon",slots:{customRender:"icon"},slotsType:"component",slotsFunc:e=>a(F,{type:e.icon})},{title:"排序",dataIndex:"sort"},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>U(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>U(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},a)=>e.id<6?C.warn("系统预置菜单，不能删除！"):await $(e.id).then((()=>a()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:e},a)=>M(G,{fields:e,callback:a})}]}];var W=r({name:"system-access",components:{DynamicTable:L},setup(){const l=p(null),d=f({itemRefs:{},expandedRowKeys:[],tableLoading:!1,rowSelection:{onChange:(e,a)=>{d.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),n=S((()=>0==d.rowSelection.selectedRowKeys.length));return e(e({},v(d)),{columns:V,tableRef:l,expand:async(e,l)=>{const n=d.itemRefs[l.id],r=await(async({expanded:e,record:l,expandItemEl:d,asyncFunc:n,params:r})=>{if(e&&l.children&&!Array.isArray(l.children)){const e=d.closest("td").querySelector(".ant-table-row-expand-icon");return t(a(o),e),await s(),e.classList.add("loading-icon"),n(r).finally((async()=>{t(null,e),await s(),e.classList.remove("loading-icon")}))}})({expanded:e,record:l,expandItemEl:n,asyncFunc:Q,params:{id:l.id,limit:100}});(null==r?void 0:r.data)&&(l.children=r.data)},getAdminAccess:Q,isDisabled:n,addItem:()=>{M(G,{callback:()=>{l.value.refreshTableData()}})},deleteItems:()=>{i.confirm({title:"提示",icon:a(K),content:"您确定要删除所有选中吗？",onOk:async()=>{await $(d.rowSelection.selectedRowKeys.toString()),await l.value.refreshTableData(),d.rowSelection.selectedRowKeys=[]}})}})}});const Y=N(" 添加 "),ee=N(" 删除 ");W.render=function(e,l,t,o,s,d){const n=w("a-button"),r=w("dynamic-table"),i=T("permission");return h(),x(r,{ref:"tableRef",onExpand:e.expand,columns:e.columns,"get-list-func":e.getAdminAccess,rowKey:"id","row-selection":e.rowSelection},{title:j((()=>[O(a(n,{onClick:e.addItem,type:"primary"},{default:j((()=>[Y])),_:1},8,["onClick"]),[[i,{action:"create",effect:"disabled"}]]),O(a(n,{onClick:e.deleteItems,disabled:e.isDisabled,type:"primary"},{default:j((()=>[ee])),_:1},8,["onClick","disabled"]),[[i,{action:"delete"}]])])),moduleName:j((({record:l})=>[a("span",{ref:a=>e.itemRefs[l.id]=a},E(l.moduleName||l.actionName),513)])),_:1},8,["onExpand","columns","get-list-func","row-selection"])};export default W;
