var e=Object.assign;import{bV as t,cz as n,cA as o,d as a,B as i,P as s,i as l,a as r,q as c,h as d,g as u,c as p,b_ as m,cB as f,cC as g,u as h,cD as b,cE as v,a7 as y,r as O,aa as k,S as C,t as w,Z as x,z as S,A as z,n as P,F as V,cF as F,G as T,cr as $,x as j,y as _,bs as R,b5 as D,a0 as L,br as W,$ as B,ad as H,a3 as I,a2 as N,a1 as E,C as X}from"./index.c2de4877.js";import{_ as A}from"./schema-form.05eb43a4.js";function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var U=n(),q=o(),G=t(a({name:"APopconfirm",mixins:[i],props:K(K({},U),{prefixCls:s.string,transitionName:s.string.def("zoom-big"),content:s.any,title:s.any,trigger:U.trigger.def("click"),okType:q.type.def("primary"),disabled:s.looseBool.def(!1),okText:s.any,cancelText:s.any,icon:s.any,okButtonProps:s.object,cancelButtonProps:s.object,onConfirm:s.func,onCancel:s.func,onVisibleChange:s.func}),emits:["update:visible","confirm","cancel","visibleChange"],setup:function(){return{configProvider:l("configProvider",r)}},data:function(){var e=c(this),t={sVisible:!1};return"visible"in e&&(t.sVisible=e.visible),"defaultVisible"in e&&(t.sVisible=e.defaultVisible),t},watch:{visible:function(e){this.sVisible=e}},methods:{onConfirmHandle:function(e){this.setVisible(!1,e),this.$emit("confirm",e)},onCancelHandle:function(e){this.setVisible(!1,e),this.$emit("cancel",e)},onVisibleChangeHandle:function(e){this.$props.disabled||this.setVisible(e)},setVisible:function(e,t){d(this,"visible")||this.setState({sVisible:e}),this.$emit("update:visible",e),this.$emit("visibleChange",e,t)},getPopupDomNode:function(){return this.$refs.tooltip.getPopupDomNode()},renderOverlay:function(e,t){var n=this,o=this.okType,a=this.okButtonProps,i=this.cancelButtonProps,s=u(this,"icon")||p(m,null,null),l=f(K({size:"small",onClick:this.onCancelHandle},i)),r=f(K({type:o,size:"small",onClick:this.onConfirmHandle},a));return p("div",{class:"".concat(e,"-inner-content")},[p("div",{class:"".concat(e,"-message")},[s,p("div",{class:"".concat(e,"-message-title")},[u(this,"title")])]),p("div",{class:"".concat(e,"-buttons")},[p(g,l,{default:function(){return[u(n,"cancelText")||t.cancelText]}}),p(g,r,{default:function(){return[u(n,"okText")||t.okText]}})])])}},render:function(){var e,t=this,n=c(this),o=n.prefixCls,a=(0,this.configProvider.getPrefixCls)("popover",o),i=h(n,["title","content","cancelText","okText","onUpdate:visible"]),s=p(v,{componentName:"Popconfirm",defaultLocale:b.Popconfirm,children:function(e){return t.renderOverlay(a,e)}},null),l=K(K({},i),{title:s,prefixCls:a,visible:this.sVisible,ref:"tooltip",onVisibleChange:this.onVisibleChangeHandle});return p(y,l,{default:function(){return[null===(e=t.$slots)||void 0===e?void 0:e.default()]}})}}));var J=a({name:"operate-modal",components:{[k.name]:k,SchemaForm:A},props:{remove:{type:Function},formSchema:{type:Object,default:()=>({})},fields:{type:Object,default:()=>({})},hiddenFields:{type:Array,default:()=>[]},handleOk:{type:Function}},setup(t){const n=O(null),o=C({visible:!0,confirmLoading:!1,dynamicValidateForm:t.formSchema});t.hiddenFields.forEach((e=>o.dynamicValidateForm.formItem.find((t=>t.field==e)).hidden=!!t.fields));return e(e({},w(o)),{onOk:()=>{o.confirmLoading=!0,n.value.validate().then((async e=>{await(t.handleOk&&t.handleOk(n.value.modelRef,o)).finally((()=>o.confirmLoading=!1)),o.visible=!1})).catch((e=>{o.confirmLoading=!1}))},dynamicForm:n})}});const M=V("data-v-74cbe420"),Q=M(((e,t,n,o,a,i)=>{const s=x("schema-form"),l=x("a-modal");return S(),z(l,P(e.$attrs,{visible:e.visible,"onUpdate:visible":t[1]||(t[1]=t=>e.visible=t),"confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.onOk}),{default:M((()=>[p(s,{ref:"dynamicForm",fields:e.fields,"form-schema":e.dynamicValidateForm},null,8,["fields","form-schema"])])),_:1},16,["visible","confirm-loading","afterClose","onOk"])}));J.render=Q,J.__scopeId="data-v-74cbe420";const Z=e=>{let t,n,o,a;const i=()=>a.onmouseup=a.onmousedown=a.onmousemove=null;e.forEach((e=>e.customHeaderCell=e=>({onmouseenter:()=>{a=e.title[0].el.closest("th"),null!=o||(o=a.closest(".ant-table-wrapper")),null!=n||(n=o.clientWidth),a.onmousemove=function(e){e.offsetX>this.offsetWidth-10?this.style.cursor="col-resize":this.style.cursor="default",null==t&&(t=this),null!=t.mouseDown&&1==t.mouseDown&&(t.style.cursor="default",t.oldWidth+(e.x-t.oldX)>0&&(t.width=t.oldWidth+(e.x-t.oldX)),t.style.width=t.width,o.style.width=n+(e.x-t.oldX)+"px",t.style.cursor="col-resize")},a.onmousedown=function(e){t=this,e.offsetX>t.offsetWidth-10&&(t.mouseDown=!0,t.oldX=e.x,t.oldWidth=t.offsetWidth)},a.onmouseup=i,o.onmouseup=function(){i(),null==t&&(t=this),t.mouseDown=!1,t.style.cursor="default",n=o.clientWidth}},onmouseup:()=>i})))};var Y=a({name:"dynamic-table",props:{columns:{type:Object},getListFunc:{type:Function},rowSelection:{type:Object},rowKey:{type:[String,Function]},pageOption:{type:Object,default:()=>({})}},components:{[F.name]:F,[T.name]:T,[$.name]:$,[G.name]:G,Option:$.Option},setup(t,{attrs:n,emit:o,slots:a}){var i;const{pageOption:s}=function(t){const n=O(e({current:1,pageSize:10,total:0,pageSizeOptions:["10","20","30","40","50"],showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`,onChange:(e,n)=>{var o;return null==(o=null==t?void 0:t.pageChange)?void 0:o.call(t,e,n)},onShowSizeChange:(e,n)=>{var o;return null==(o=null==t?void 0:t.pageChange)?void 0:o.call(t,e,n)}},t));return{pageOption:n,updatePageOption:(e={})=>{Object.assign(n.value,e)}}}();Z(t.columns);const l=C({expandItemRefs:{},customRow:()=>({}),data:[],pageOption:Object.assign(s,t.pageOption),actions:(null==(i=t.columns.find((e=>"action"==(e.dataIndex||e.key))))?void 0:i.actions)||[],loading:!1}),r=async(n={})=>{n=e(e({pageNumber:l.pageOption.current,pageSize:l.pageOption.pageSize},t.pageOption),n),l.loading=!0;const{data:o,pageNumber:a,pageSize:i,total:s}=await t.getListFunc(n).finally((()=>l.loading=!1));Object.assign(l.pageOption,{current:~~a,pageSize:~~i,total:~~s}),l.data=o,l.customRow=function(e){let t,n;return o=>({draggable:!0,ondrag(e){t=o},ondrop(e){n=o},ondragend(o){if(t!==n){const o=e.indexOf(t),a=e.indexOf(n);[e[o],e[a]]=[e[a],e[o]]}},ondragover:e=>!1})}(l.data)};r();return e(e({},w(l)),{buttonProps:{size:"small"},actionEvent:async(e,n,o)=>{await n({record:e,props:t},(()=>setTimeout((()=>r())))),"del"==o&&l.data.length<2&&(l.pageOption.current=Math.max(1,l.pageOption.current-1))},refreshTableData:r,paginationChange:(n,o,a)=>{const{field:i,order:s}=a;l.pageOption=e(e({},l.pageOption),n),r(e(e(e({pageSize:n.pageSize,pageNumber:n.current},t.pageOption),o),{field:i,order:s}))}})}});const ee=V("data-v-0379443c");j("data-v-0379443c");const te=N(" 您确定要删除吗？ ");_();const ne=ee(((t,n,o,a,i,s)=>{const l=x("router-link"),r=x("Option"),c=x("a-select"),d=x("a-button"),u=x("a-popconfirm"),m=x("a-table"),f=R("permission");return S(),z(m,P({columns:t.columns,loading:t.loading,rowSelection:t.rowSelection,rowKey:t.rowKey,size:"middle","data-source":t.data,pagination:t.pageOption,bordered:"",customRow:t.customRow,onChange:t.paginationChange},e(e({},t.$props),t.$attrs)),D({_:2},[L(t.$slots,((e,n)=>({name:n,fn:ee((e=>[W(t.$slots,n,e)]))}))),L(t.columns.filter((e=>e.slots)),(n=>({name:n.slots.customRender,fn:ee((o=>[t.$slots[n.slots.customRender]?W(t.$slots,n.slots.customRender,P({key:0},o)):(S(),z(B,{key:1},["action"!==n.slots.customRender?(S(),z(B,{key:0},["component"==n.slotsType?(S(),z(H(n.slotsFunc(o.record)),{key:0})):I("",!0),"format"==n.slotsType?(S(),z(B,{key:1},[N(E(n.slotsFunc(o.record[n.dataIndex||n.key],o.record)),1)],64)):I("",!0),"link"==n.slotsType?(S(),z(l,{key:2,to:n.linkPath+o.record[n.linkId]},{default:ee((()=>[N(E(o.text),1)])),_:2},1032,["to"])):I("",!0)],64)):I("",!0),"action"==n.slots.customRender?(S(),z("div",{key:n.slots.customRender,class:"actions"},[(S(!0),z(B,null,L(t.actions,((n,a)=>(S(),z(B,null,["select"==n.type?(S(),z(c,{value:o.record[n.key],"onUpdate:value":e=>o.record[n.key]=e,key:a,size:"small"},{default:ee((()=>[(S(!0),z(B,null,L(n.options,(e=>(S(),z(r,{value:e.value,key:e.value},{default:ee((()=>[N(E(e.label),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):I("",!0),"button"==n.type?X((S(),z(d,P({key:1},e(e({},t.buttonProps),n.props),{onClick:e=>t.actionEvent(o.record,n.func),key:a}),{default:ee((()=>[N(E(n.text),1)])),_:2},1040,["onClick"])),[[f,n.permission]]):I("",!0),"popconfirm"==n.type?(S(),z(u,{key:a,placement:"leftTop",onConfirm:e=>t.actionEvent(o.record,n.func,"del")},{title:ee((()=>[te])),default:ee((()=>[p(d,e(e({},t.buttonProps),n.props),{default:ee((()=>[N(E(n.text),1)])),_:2},1040)])),_:2},1032,["onConfirm"])):I("",!0)],64)))),256))])):I("",!0)],64))]))})))]),1040,["columns","loading","rowSelection","rowKey","data-source","pagination","customRow","onChange"])}));Y.render=ne,Y.__scopeId="data-v-0379443c";export{Y as _,J as a};
