var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,c=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&l(e,a,t[a]);if(s)for(var a of s(t))i.call(t,a)&&l(e,a,t[a]);return e},o=(e,s)=>t(e,a(s));import{d as r,bj as d,b4 as p,l as u,m,o as f,k as y,A as h,c as b,e as v,B as w,f as g,r as k,M as I,aE as R,bh as K,w as S,i as j}from"./vendor.c1c0e565.js";import{_ as x}from"./dynamic-table.346a87a7.js";import{a as O,d as A,p as C,g as T,b as D}from"./index.4f788f67.js";import{f as L}from"./common.8f5395bc.js";import{u as N}from"./index.e1b4ba94.js";import"./schema-form.0256b7ba.js";import"./index.83024206.js";var P=r({name:"AccessTree",components:{[d.name]:d,[p.name]:p},props:{value:{type:Array,default:()=>[]}},emits:["update:value"],setup(e,{emit:t}){const a=u({treeData:[],spinning:!1,replaceFields:{key:"id"}}),s=(e,t=-1)=>e.filter((e=>e.moduleId==t)).map((t=>o(c({},t),{title:t.moduleName||t.actionName,children:s(e,t.id)}))),n=m({get:()=>e.value,set:e=>t("update:value",Array.isArray(e)?e:e.checked)});f((async()=>{a.spinning=!0;const e=await O().finally((()=>a.spinning=!1));a.treeData=s(e)}));const i=(e,t=[])=>e.eventKey?(t.push(e.eventKey),i(e.vcTreeNode,t)):t,l=(e,t=[])=>(null==e?void 0:e.children.length)>0?e.children.reduce(((e,t)=>(t.children.length>0&&e.push(...l(t,e),[]),e.concat([t.id]))),t):t;return o(c({},y(a)),{checkedKeys:n,onCheck:(e,{node:t,checked:a})=>{var s,c,o;let r=n.value;if(a)r=[...new Set([...n.value,...e.checked,...i(t.vcTreeNode),...l(t.dataRef)])];else{const a=l(t.dataRef);r=a.length>0?e.checked.filter((e=>!a.includes(e))):e.checked;((null==(o=null==(c=null==(s=t.vcTreeNode)?void 0:s.dataRef)?void 0:c.children)?void 0:o.map((e=>e.id)))||[]).some((e=>r.includes(e)))||(r=r.filter((e=>{var a;return e!=(null==(a=t.vcTreeNode)?void 0:a.eventKey)})))}n.value=r}})}});P.render=function(e,t,a,s,n,i){const l=h("a-tree"),c=h("a-spin");return b(),v(c,{spinning:e.spinning},{default:w((()=>[g(l,{checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":t[1]||(t[1]=t=>e.checkedKeys=t),style:{"min-height":"40px"},checkable:"",checkStrictly:"",selectable:!1,"tree-data":e.treeData,"replace-fields":e.replaceFields,onCheck:e.onCheck},null,8,["checkedKeys","tree-data","replace-fields","onCheck"])])),_:1},8,["spinning"])};const _=()=>({style:{width:"auto"},formItemLayout:{labelCol:{span:4},wrapperCol:{span:20}},formItem:[{type:"input",label:"角色名称",field:"title",value:"",props:{placeholder:"请输入角色名称"},rules:[{required:!0,message:"角色名称不能为空"}]},{type:"textarea",label:"描述",field:"description",value:"",props:{placeholder:"角色描述"}},{type:g(P),label:"资源",field:"accessIdsList",value:[],asyncValue:async(e,t)=>{const{id:a}=null==t?void 0:t.props.fields;return(await O(a)).map((e=>e.accessId))}}]}),F=[{title:"角色名称",dataIndex:"title"},{title:"描述",dataIndex:"description"},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>L(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>L(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},t)=>await A(e.id).then((()=>t()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:e},t)=>N({title:"编辑角色",fields:e,formSchema:_(),handleOk:async(a,s)=>{const{description:n,title:i,accessIdsList:l}=a,c={description:n,title:i,accessIdsList:l.toString()};return await C(e.id,c).then((()=>t()))}})}]}];var E=r({name:"SystemRole",components:{DynamicTable:x},setup(){const e=k(null),t=u({tableLoading:!1,rowSelection:{onChange:(e,a)=>{t.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),a=m((()=>0==t.rowSelection.selectedRowKeys.length));return o(c({},y(t)),{columns:F,tableRef:e,getAdminRole:T,isDisabled:a,addItem:()=>{N({title:"添加角色",formSchema:_(),handleOk:async(t,a)=>{const{description:s,title:n,accessIdsList:i}=t,l={description:s,title:n,accessIdsList:i.toString()};await D(l),e.value.refreshTableData()}})},deleteItems:()=>{I.confirm({title:"提示",icon:g(R),content:"您确定要删除所有选中吗？",onOk:async()=>{await A(t.rowSelection.selectedRowKeys.toString()),e.value.refreshTableData(),t.rowSelection.selectedRowKeys=[]}})}})}});const q=j(" 添加 "),B=j(" 删除 ");E.render=function(e,t,a,s,n,i){const l=h("a-button"),c=h("dynamic-table"),o=K("permission");return b(),v(c,{ref:"tableRef",columns:e.columns,"get-list-func":e.getAdminRole,rowKey:"id","row-selection":e.rowSelection},{title:w((()=>[S(g(l,{type:"primary",onClick:e.addItem},{default:w((()=>[q])),_:1},8,["onClick"]),[[o,{action:"create",effect:"disabled"}]]),S(g(l,{disabled:e.isDisabled,type:"primary",onClick:e.deleteItems},{default:w((()=>[B])),_:1},8,["disabled","onClick"]),[[o,{action:"delete"}]])])),_:1},8,["columns","get-list-func","row-selection"])};export default E;
