var e,t=Object.defineProperty,s=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(e,s,o)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,c=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&i(e,s,t[s]);if(a)for(var s of a(t))n.call(t,s)&&i(e,s,t[s]);return e},l=(e,t)=>s(e,o(t));import{d,r as u,l as m,m as p,k as f,M as y,f as b,aE as w,A as g,bh as h,c as S,e as A,B as j,w as x,i as O}from"./vendor.c1c0e565.js";import{_ as v}from"./dynamic-table.bf7909c0.js";import{A as T,R}from"./index.73ccbe68.js";import{f as I}from"./common.8f5395bc.js";import{u as E}from"./index.dcdac307.js";import{g as k}from"./index.fb9f6be6.js";import"./schema-form.4595d7ea.js";function M(t){return T.request({url:e.adminAccount,method:R.GET,params:t},{isShowErrorMessage:!0})}function q(t){return T.request({url:[e.adminAccount,t].join("/"),method:R.DELETE},{isShowErrorMessage:!0,successMessageText:"删除成功"})}(e||(e={})).adminAccount="/admin/account";const D=()=>({formItem:[{type:"input",label:"用户名",field:"username",value:"",props:{placeholder:"请输入用户名"},rules:[{required:!0,message:"用户名不能为空"}]},{type:"input",label:"密码",field:"password",hidden:!1,value:"",props:{type:"password",placeholder:"请输入密码"},rules:[{required:!0,message:"密码不能为空"}]},{type:"checkbox",label:"角色",field:"roles",value:[],options:[],loading:!0,rules:[{required:!0,message:"请选择角色",type:"array"}],asyncOptions:async()=>{const{data:e}=await k({});return e.map((e=>({label:e.title,value:e.id})))}}]}),P=[{title:"用户名",dataIndex:"username"},{title:"所属角色",dataIndex:"roles",slots:{customRender:"roles"},slotsType:"format",slotsFunc:e=>e.map((e=>e.title)).join(", ")},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>I(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>I(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},t)=>await q(e.id).then((()=>t()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:t},s)=>E({title:"编辑账号",fields:l(c({},t),{roles:null==t?void 0:t.roles.map((e=>e.id))}),hiddenFields:["password"],formSchema:D(),handleOk:async(o,a)=>{const{username:r,password:n,roles:i}=o,c={username:r,password:n,roles:i.toString()};return await function(t,s){return T.request({url:[e.adminAccount,t].join("/"),method:R.PATCH,params:s},{isShowErrorMessage:!0,successMessageText:"修改成功"})}(t.id,c).then((()=>s()))}})}]}];var C=d({name:"SystemAccount",components:{DynamicTable:v},setup(){const t=u(null),s=m({tableLoading:!1,rowSelection:{onChange:(e,t)=>{s.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),o=p((()=>0==s.rowSelection.selectedRowKeys.length));return l(c({},f(s)),{columns:P,tableRef:t,getAdminAccount:M,isDisabled:o,addItem:()=>{E({title:"添加账号",formSchema:D(),handleOk:async(s,o)=>{const{username:a,password:r,roles:n}=s,i={username:a,password:r,roles:n.toString()};await function(t){return T.request({url:e.adminAccount,method:R.POST,params:t},{isShowErrorMessage:!0,successMessageText:"新建成功"})}(i),t.value.refreshTableData()}})},deleteItems:()=>{y.confirm({title:"提示",icon:b(w),content:"您确定要删除所有选中吗？",onOk:async()=>{await q(s.rowSelection.selectedRowKeys.toString()),t.value.refreshTableData(),s.rowSelection.selectedRowKeys=[]}})}})}});const K=O(" 添加 "),F=O(" 删除 ");C.render=function(e,t,s,o,a,r){const n=g("a-button"),i=g("dynamic-table"),c=h("permission");return S(),A(i,{ref:"tableRef",columns:e.columns,"get-list-func":e.getAdminAccount,rowKey:"id","row-selection":e.rowSelection},{title:j((()=>[x(b(n,{type:"primary",onClick:e.addItem},{default:j((()=>[K])),_:1},8,["onClick"]),[[c,{action:"create",effect:"disabled"}]]),x(b(n,{disabled:e.isDisabled,type:"primary",onClick:e.deleteItems},{default:j((()=>[F])),_:1},8,["disabled","onClick"]),[[c,{action:"delete"}]])])),_:1},8,["columns","get-list-func","row-selection"])};export default C;
