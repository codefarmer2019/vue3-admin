var e,t=Object.defineProperty,s=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,r=(e,s,a)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,n=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&r(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&r(e,n,t[n]);return e};import{ct as i,cu as l,d as c,r as d,S as u,U as m,t as p,ab as f,c as y,Y as b,bo as w,z as g,A as h,a6 as S,C as j,a3 as x}from"./index.387353af.js";import{_ as A}from"./dynamic-table.aa4772e5.js";import{f as v}from"./common.d76a3fc3.js";import{u as T}from"./index.e5c9d822.js";import{g as O}from"./index.2bb0dbcb.js";import{Q as I}from"./QuestionCircleOutlined.236020bc.js";import"./vendor.183d7d35.js";import"./schema-form.ff968d6e.js";function R(t){return i.request({url:e.adminAccount,method:l.GET,params:t},{isShowErrorMessage:!0})}function E(t){return i.request({url:[e.adminAccount,t].join("/"),method:l.DELETE},{isShowErrorMessage:!0,successMessageText:"删除成功"})}(e||(e={})).adminAccount="/admin/account";const k=()=>({formItem:[{type:"input",label:"用户名",field:"username",value:"",props:{placeholder:"请输入用户名"},rules:[{required:!0,message:"用户名不能为空"}]},{type:"input",label:"密码",field:"password",hidden:!1,value:"",props:{type:"password",placeholder:"请输入密码"},rules:[{required:!0,message:"密码不能为空"}]},{type:"checkbox",label:"角色",field:"roles",value:[],options:[],loading:!0,rules:[{required:!0,message:"请选择角色",type:"array"}],asyncOptions:async()=>{const{data:e}=await O({});return e.map((e=>({label:e.title,value:e.id})))}}]}),C=[{title:"用户名",dataIndex:"username"},{title:"所属角色",dataIndex:"roles",slots:{customRender:"roles"},slotsType:"format",slotsFunc:e=>e.map((e=>e.title)).join(", ")},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>v(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>v(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},t)=>await E(e.id).then((()=>t()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:t},s)=>T({title:"编辑账号",fields:n(n({},t),{roles:null==t?void 0:t.roles.map((e=>e.id))}),hiddenFields:["password"],formSchema:k(),handleOk:async(a,o)=>{const{username:r,password:n,roles:c}=a,d={username:r,password:n,roles:c.toString()};return await function(t,s){return i.request({url:[e.adminAccount,t].join("/"),method:l.PATCH,params:s},{isShowErrorMessage:!0,successMessageText:"修改成功"})}(t.id,d).then((()=>s()))}})}]}];var q=c({name:"system-account",components:{DynamicTable:A},setup(){const t=d(null),s=u({tableLoading:!1,rowSelection:{onChange:(e,t)=>{s.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),a=m((()=>0==s.rowSelection.selectedRowKeys.length));return n(n({},p(s)),{columns:C,tableRef:t,getAdminAccount:R,isDisabled:a,addItem:()=>{T({title:"添加账号",formSchema:k(),handleOk:async(s,a)=>{const{username:o,password:r,roles:n}=s,c={username:o,password:r,roles:n.toString()};await function(t){return i.request({url:e.adminAccount,method:l.POST,params:t},{isShowErrorMessage:!0,successMessageText:"新建成功"})}(c),t.value.refreshTableData()}})},deleteItems:()=>{f.confirm({title:"提示",icon:y(I),content:"您确定要删除所有选中吗？",onOk:async()=>{await E(s.rowSelection.selectedRowKeys.toString()),t.value.refreshTableData(),s.rowSelection.selectedRowKeys=[]}})}})}});const M=x(" 添加 "),D=x(" 删除 ");q.render=function(e,t,s,a,o,r){const n=b("a-button"),i=b("dynamic-table"),l=w("permission");return g(),h(i,{ref:"tableRef",columns:e.columns,"get-list-func":e.getAdminAccount,rowKey:"id","row-selection":e.rowSelection},{title:S((()=>[j(y(n,{onClick:e.addItem,type:"primary"},{default:S((()=>[M])),_:1},8,["onClick"]),[[l,{action:"create",effect:"disabled"}]]),j(y(n,{onClick:e.deleteItems,disabled:e.isDisabled,type:"primary"},{default:S((()=>[D])),_:1},8,["onClick","disabled"]),[[l,{action:"delete"}]])])),_:1},8,["columns","get-list-func","row-selection"])};export default q;
